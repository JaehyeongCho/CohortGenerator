<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating Cohorts • CohortGenerator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generating Cohorts">
<meta property="og:description" content="CohortGenerator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CohortGenerator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GeneratingCohorts.html">Generating Cohorts</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/CohortGenerator/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="GeneratingCohorts_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Generating Cohorts</h1>
                        <h4 class="author">Anthony G. Sena</h4>
            
            <h4 class="date">2021-12-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/CohortGenerator/blob/master/vignettes/GeneratingCohorts.Rmd"><code>vignettes/GeneratingCohorts.Rmd</code></a></small>
      <div class="hidden name"><code>GeneratingCohorts.Rmd</code></div>

    </div>

    
    
<div id="guide-for-generating-cohorts-using-cohortgenerator" class="section level1">
<h1 class="hasAnchor">
<a href="#guide-for-generating-cohorts-using-cohortgenerator" class="anchor"></a>Guide for generating cohorts using CohortGenerator</h1>
<p>This guide will provide examples of using the CohortGenerator package to generate <a href="https://ohdsi.github.io/TheBookOfOhdsi/Cohorts.html">cohorts</a> in R. In this vignette, we will walk through the process of downloading cohorts from ATLAS and look at the options available for generating the cohorts.</p>
<div id="basic-example" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-example" class="anchor"></a>Basic Example</h2>
<div id="downloading-cohorts-from-atlas" class="section level3">
<h3 class="hasAnchor">
<a href="#downloading-cohorts-from-atlas" class="anchor"></a>Downloading cohorts from ATLAS</h3>
<p>We can create cohorts using <a href="https://github.com/OHDSI/Atlas">ATLAS</a> and download them for generation in R. To do this, we will use the <code>ROhdsiWebApi</code> package to download some cohort definitions to R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Connect to WebAPI and retrieve the full list of cohorts</span>
<span class="va">cohortDefinitions</span> <span class="op">&lt;-</span> <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/getCohortDefinitionsMetaData.html">getCohortDefinitionsMetaData</a></span><span class="op">(</span>baseUrl <span class="op">=</span> <span class="va">baseUrl</span><span class="op">)</span>
<span class="co"># Filter the list to the cohorts for this example</span>
<span class="va">cohortsForGeneration</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^\\[CohortGenerator\\]"</span>, <span class="va">cohortDefinitions</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Get the SQL/JSON for the cohorts</span>
<span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/exportCohortDefinitionSet.html">exportCohortDefinitionSet</a></span><span class="op">(</span>baseUrl <span class="op">=</span> <span class="va">baseUrl</span>,
                                                               cohortIds <span class="op">=</span> <span class="va">cohortsForGeneration</span><span class="op">$</span><span class="va">id</span>,
                                                               generateStats <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The code above connects to ATLAS’s WebAPI, retrieves all of the <code>cohortDefinitions</code> and then filters them based on the name to produce the <code>cohortsForGeneration</code> data frame. <code>cohortsForGeneration</code> contains the list of cohort IDs to use for calling the function <code><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/exportCohortDefinitionSet.html">ROhdsiWebApi::exportCohortDefinitionSet</a></code> to download the set of cohort definitions into <code>cohortDefinitionSet</code>. The cohort definition set data frame has the following columns:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "atlasId"          "cohortId"         "cohortName"       "sql"             
#&gt; [5] "json"             "logicDescription"</code></pre>
<p>Here is how these columns are used:</p>
<ul>
<li>
<strong>atlasId</strong>: The ATLAS ID for the cohort. This provides linkage back to the ATLAS cohort definition</li>
<li>
<strong>cohortId</strong>: The cohortId will be the same as the atlasId upon export from ATLAS. We provide this column in case you’d like to alter the numbering scheme for your cohort definition set.</li>
<li>
<strong>cohortName</strong>: The name of the cohort in ATLAS.</li>
<li>
<strong>sql</strong>: The SQL used to construct the cohort.</li>
<li>
<strong>json</strong>: The <a href="https://github.com/OHDSI/circe-be">Circe</a> compliant JSON representation of the cohort definition</li>
<li>
<strong>logicDescription</strong>: The description of the cohort from ATLAS.</li>
</ul>
</div>
<div id="generating-cohorts" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-cohorts" class="anchor"></a>Generating Cohorts</h3>
<p>Now that we have obtained the <code>cohortDefinitionSet</code> from ROhdsiWebApi, we’re ready to generate our cohorts against our OMOP CDM. In this example, we will use the <a href="https://github.com/OHDSI/Eunomia">Eunomia</a> data set as our CDM.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the Eunomia connection details</span>
<span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html">getEunomiaConnectionDetails</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># First get the cohort table names to use for this generation task</span>
<span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span>cohortTable <span class="op">=</span> <span class="st">"cg_example"</span><span class="op">)</span>

<span class="co"># Next create the tables on the database</span>
<span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                                    cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                                    cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                                    incremental <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Connecting using SQLite driver</code></pre>
<pre><code>#&gt; Creating cohort tables
#&gt; - Created table main.cg_example
#&gt; - Created table main.cg_example_inclusion
#&gt; - Created table main.cg_example_inclusion_result
#&gt; - Created table main.cg_example_inclusion_stats
#&gt; - Created table main.cg_example_summary_stats
#&gt; - Created table main.cg_example_censor_stats
#&gt; Creating cohort tables took 0.52secs</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate the cohort set</span>
<span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span>connectionDetails<span class="op">=</span> <span class="va">connectionDetails</span>,
                                   cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                                   cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                                   cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                                   cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span>,
                                   incremental <span class="op">=</span> <span class="cn">FALSE</span>,
                                   incrementalFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">folderName</span>, <span class="st">"RecordKeeping"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Connecting using SQLite driver</code></pre>
<pre><code>#&gt; 1/3- Generating cohort: [CohortGenerator] celecoxib
#&gt; 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre><code>#&gt; Executing SQL took 0.073 secs</code></pre>
<pre><code>#&gt; 2/3- Generating cohort: [CohortGenerator] celecoxib age 40
#&gt; 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre><code>#&gt; Executing SQL took 0.065 secs</code></pre>
<pre><code>#&gt; 3/3- Generating cohort: [CohortGenerator] celecoxib age 40 and male
#&gt; 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |================                                                      |  24%
  |                                                                            
  |===================                                                   |  26%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |===================================================                   |  74%
  |                                                                            
  |======================================================                |  76%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre><code>#&gt; Executing SQL took 0.105 secs</code></pre>
<pre><code>#&gt; Generating cohort set took 0.52 secs</code></pre>
<pre><code>#&gt;   cohortId                                  cohortName generationStatus
#&gt; 1  1778211                 [CohortGenerator] celecoxib         COMPLETE
#&gt; 2  1778212          [CohortGenerator] celecoxib age 40         COMPLETE
#&gt; 3  1778213 [CohortGenerator] celecoxib age 40 and male         COMPLETE
#&gt;             startTime             endTime
#&gt; 1 2021-12-06 14:11:10 2021-12-06 14:11:10
#&gt; 2 2021-12-06 14:11:10 2021-12-06 14:11:10
#&gt; 3 2021-12-06 14:11:10 2021-12-06 14:11:10</code></pre>
<p>The code above starts by obtaining the <code>connectionDetails</code> from Eunomia. This is where you’ll likley want to substitute your own connection information. Next, we call <code>getCohortTableNames</code> to obtain a list of <code>cohortTableNames</code> that we’ll use for the generation process. We then call <code>createCohortTables</code> to create the cohort tables on the database server in the <code>cohortDatabaseSchema</code>. Once these tables are created, we use the function <code>generateCohortSet</code> to generate the <code>cohortDefintionSet</code>. When calling <code>generateCohortSet</code>, we must specify the schema that holds our CDM (<code>cdmDatabaseSchema</code>), the location of the <code>cohortDatabaseSchema</code> and <code>cohortTableNames</code> where the cohort(s) will be generated. We will cover the other parameters available in the <a href="#advancedOptions">Advanced Options</a> section.</p>
<p>If we’d like to see the results of the generation process, we can use the <code>getCohortCounts</code> method to query the cohort table for a summary of the persons and events for each cohort:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cohortCounts</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/getCohortCounts.html">getCohortCounts</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                                                 cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                                                 cohortTable <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">$</span><span class="va">cohortTable</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Connecting using SQLite driver</code></pre>
<pre><code>#&gt; Counting cohorts took 0.036 secs</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cohortCounts</span></code></pre></div>
<pre><code>#&gt;   cohortId cohortEntries cohortSubjects
#&gt; 1  1778211          1800           1800
#&gt; 2  1778212           569            569
#&gt; 3  1778213           266            266</code></pre>
</div>
</div>
<div id="advancedOptions" class="section level2">
<h2 class="hasAnchor">
<a href="#advancedOptions" class="anchor"></a>Advanced Options</h2>
<div id="cohort-statistics-inclusion-rule-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#cohort-statistics-inclusion-rule-statistics" class="anchor"></a>Cohort Statistics (Inclusion Rule Statistics)</h3>
<p>TODO</p>
</div>
<div id="incremental-options" class="section level3">
<h3 class="hasAnchor">
<a href="#incremental-options" class="anchor"></a>Incremental Options</h3>
<p>TODO</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Anthony Sena, Gowtham Rao, Martijn Schuemie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
